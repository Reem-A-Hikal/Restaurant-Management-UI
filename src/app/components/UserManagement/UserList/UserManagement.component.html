<section [ngClass]="getBodyClass()">
  <div class="container mt-4">
    <app-TopPage
      [searchPlaceholder]="'Search for users...'"
      [addButtonLabel]="'Add User'"
      [filterOptions]="filterOptions"
      (search)="applyFilter({ searchTerm: $event, selectedRole: selectedRole })"
      (reset)="reset()"
      (filterChange)="applyFilter({ searchTerm: searchTerm, selectedRole: $event })"
      (add)="addUser()"
    ></app-TopPage>
    <!-- Loading Indicator -->
    <div
      *ngIf="isLoading"
      class="position-fixed top-0 start-0 w-100 h-100 d-flex justify-content-center align-items-center bg-light bg-opacity-50"
      style="z-index: 1050"
    >
      <div class="text-center">
        <div
          class="spinner-border text-success mb-3"
          style="width: 3rem; height: 3rem"
          role="status"
        ></div>
        <div><strong class="text-success">Loading...</strong></div>
      </div>
    </div>

    <div *ngIf="!isLoading" #UsersContainer>
      <div
        class="row justify-content-center"
        *ngIf="filteredUsers.length > 0; else noUsers"
      >
        <div
          class="col-md-4 column mb-4"
          *ngFor="let user of filteredUsers; let i = index"
        >
          <div class="card profile-card">
            <div class="background-block">
              <img
                src="/background.jpg"
                alt="profile-sample1"
                class="background"
              />
            </div>
            <div class="active-badge position-absolute">
              {{ user.isActive ? "Active" : "Inactive" }}
            </div>
            <div class="delete">
              <button
                type="button"
                class="btn btn-danger btn-sm"
                (click)="deleteUser(user.id)"
                mdbTooltip="Delete User"
              >
                <i class="fas fa-trash-alt"></i>
              </button>
            </div>
            <div class="profile-thumb-block">
              <img
                [src]="user.profileImageUrl"
                alt="profile-image"
                class="profile"
              />
            </div>
            <div class="card-content">
              <h2>{{ user.fullName }}</h2>
              <div class="mb-2">
                <span
                  class="badge badge-success"
                  *ngFor="let role of user.roles"
                >
                  {{ role }}
                </span>
              </div>
              <div class="info p-2 mt-3">
                <div class="content">
                  <div class="d-flex align-items-center">
                    <i class="fas fa-envelope me-2 text-success"></i>
                    <p class="mb-1 background">{{ user.email }}</p>
                  </div>
                  <div class="d-flex align-items-center">
                    <i class="fas fa-phone me-2 text-success"></i>
                    <p class="mb-1 background">{{ user.phoneNumber }}</p>
                  </div>
                </div>
              </div>
              <div
                class="profile-card-footer d-flex justify-content-between align-items-center gap-1"
              >
                <p class="mb-0 footer-text">
                  <span class="text-muted">Joined at </span>
                  {{ user.joinDate | date }}
                </p>
                <div
                  class="d-flex footer-icon align-items-center"
                  mdbTooltip="View User Details"
                >
                  <a
                    class="footer-text text-black text-decoration-none"
                    (click)="openModal(user)"
                  >
                    View
                  </a>
                  <i class="fas fa-angle-right text-success"></i>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Pagination -->
    @if (!isEmpty && !isLoading) {
    <app-pagination
      [pageIndex]="pagination.pageIndex"
      [totalPages]="pagination.totalPages"
      [totalItems]="pagination.totalItems"
      (pageChange)="onPageChange($event)"
    ></app-pagination>
    }
    <!-- End Pagination -->
  </div>

  <ng-template #noUsers>
    <div class="col-12 text-center py-5">
      <div class="card border-0">
        <div class="card-body py-5">
          <i class="bi bi-box-seam display-4 text-muted mb-3"></i>
          <h5 class="card-title">No users found</h5>
          <button class="btn btn-success mt-3" (click)="addUser()">
            <i class="bi bi-plus-circle me-1"></i>
            Add New User
          </button>
        </div>
      </div>
    </div>
  </ng-template>
</section>
