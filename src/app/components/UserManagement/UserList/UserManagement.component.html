<section [ngClass]="getBodyClass()">
  <div class="container mt-4">
    <div class="d-flex flex-column flex-md-row align-items-stretch gap-3 mb-4">
      <!-- Search + Filter Section -->
      <div class="d-flex flex-column flex-md-row flex-grow-1 gap-2">
        <!-- Search Box -->
        <div class="input-group flex-grow-1">
          <input
            type="search"
            name="search"
            class="form-control rounded search"
            placeholder="Search"
            [(ngModel)]="searchTerm"
            (keyup.enter)="applyFilter()"
            aria-label="Search Input"
          />
          <button
            type="button"
            class="btn btn-success"
            mdbTooltip="Search for User"
            (click)="applyFilter()"
            aria-label="search button"
          >
            <i class="fas fa-search"></i>
          </button>
          <button
            type="button"
            class="btn btn-success"
            mdbTooltip="Reset"
            (click)="reset()"
            aria-label="reset button"
          >
            <i class="fas fa-refresh"></i>
          </button>
        </div>

        <!-- Filter by Role -->
        <div class="filter">
          <select
            class="form-select"
            [(ngModel)]="selectedRole"
            (change)="applyFilter()"
            aria-label="Filter by Role"
          >
            <option *ngFor="let role of roles" [value]="role">
              {{ role }}
            </option>
          </select>
        </div>
      </div>

      <!-- Add Button -->
      <div class="add text-center flex-shrink-0">
        <button
          type="button"
          class="btn btn-success w-100 d-flex align-items-center justify-content-center"
          mdbTooltip="Add User"
        >
          <i class="fas fa-plus me-1"></i> Add User
        </button>
      </div>
    </div>
    <!-- Loading Indicator -->
    <div
      *ngIf="isLoading"
      class="position-fixed top-0 start-0 w-100 h-100 d-flex justify-content-center align-items-center bg-light bg-opacity-50"
      style="z-index: 1050"
    >
      <div class="text-center">
        <div
          class="spinner-border text-success mb-3"
          style="width: 3rem; height: 3rem"
          role="status"
        ></div>
        <div><strong class="text-success">Loading...</strong></div>
      </div>
    </div>

    <div *ngIf="!isLoading" #UsersContainer>
      <div
        class="row justify-content-center"
        *ngIf="filteredUsers.length > 0; else noUsers"
      >
        <div
          class="col-md-4 column mb-4"
          *ngFor="let user of filteredUsers; let i = index"
        >
          <div class="card profile-card">
            <div class="background-block">
              <img
                src="/background.jpg"
                alt="profile-sample1"
                class="background"
              />
            </div>
            <div class="active-badge position-absolute">
              {{ user.isActive ? "Active" : "Inactive" }}
            </div>
            <div class="delete">
              <button
                type="button"
                class="btn btn-danger btn-sm"
                (click)="deleteUser(user.id)"
                mdbTooltip="Delete User"
              >
                <i class="fas fa-trash-alt"></i>
              </button>
            </div>
            <div class="profile-thumb-block">
              <img
                [src]="user.profileImageUrl"
                alt="profile-image"
                class="profile"
              />
            </div>
            <div class="card-content">
              <h2>{{ user.fullName }}</h2>
              <div class="mb-2">
                <span class="badge me-1" *ngFor="let role of user.roles">
                  {{ role }}
                </span>
              </div>
              <div class="info p-2 mt-2">
                <div class="content">
                  <div class="d-flex align-items-center">
                    <i class="fas fa-hashtag me-2"></i>
                    <p class="mb-1">{{ i + 1 }}</p>
                  </div>
                  <div class="d-flex align-items-center">
                    <i class="fas fa-envelope me-2"></i>
                    <p class="mb-1 background">{{ user.email }}</p>
                  </div>
                  <div class="d-flex align-items-center">
                    <i class="fas fa-phone me-2"></i>
                    <p class="mb-1 background">{{ user.phoneNumber }}</p>
                  </div>
                </div>
              </div>
              <div
                class="profile-card-footer d-flex justify-content-between align-items-center gap-1"
              >
                <p class="mb-0 footer-text">
                  <span class="text-muted">Joined at </span>
                  {{ user.joinDate | date }}
                </p>
                <div
                  class="d-flex footer-icon align-items-center"
                  mdbTooltip="View User Details"
                >
                  <a
                    class="footer-text text-black text-decoration-none"
                    (click)="openModal(user)"
                  >
                    View
                  </a>
                  <i class="fas fa-angle-right text-success"></i>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Pagination -->
    @if (!isEmpty && !isLoading) {
    <app-pagination
      [pageIndex]="pagination.pageIndex"
      [totalPages]="pagination.totalPages"
      (pageChange)="onPageChange($event)"
    ></app-pagination>
    }
    <!-- End Pagination -->
  </div>

  <ng-template #noUsers>
    <div class="alert alert-info text-center">No users found</div>
  </ng-template>
</section>
